{% ckan_extends %}

{% block extras scoped %}

    {% set sortedExtras = h.sorted_extras(pkg_dict.extras) %}
    {% set sortedVodapExtras = h.filter_vodap_extras(sortedExtras) %}
    {% set extrasDict = dict(sortedExtras) %}

    {# Display publisher separately #}
    {% if ('publisher' in extrasDict or 'publisher_name' in extrasDict or 'publisher_email' in extrasDict): %}
        <tr>
            <th scope="row" class="dataset-label">{{ _('Publisher') }}</th>
            <td class="dataset-details" property="dct:publisher">
                {% if ('publisher_email' in extrasDict): %}
                {{ h.mail_to(email_address=extrasDict['publisher_email'], name=extrasDict['publisher_name'] or extrasDict['publisher_email']) }}
                {% elif ('publisher_uri' in extrasDict): %}
                <a href="{{extrasDict['publisher_uri']}}" target="_blank" rel="nofollow">{{extrasDict['publisher_name'] or extrasDict['publisher_uri']}}</a>
                {% else : %}
                {{extrasDict['publisher_name']}}
                {% endif %}
            </td>
        </tr>
    {% endif %}

    {% for extra in sortedVodapExtras %}
        {% set key, value = extra %}
            <tr rel="dc:relation" resource="_:extra{{ i }}">
                <th scope="row" class="dataset-label" property="rdfs:label">
                    {% if key in ['modified']: %}
                        {# This is the original metadata modification date #}
                        {{ _('Modified (original)') }}
                    {% else: %}
                        {{ _(key) }}
                    {% endif %}
                </th>
                <td class="dataset-details" property="rdf:value">

                    {% if key in ['language', 'theme']: %}
                        {% set parsed_value = h.json_parse(value.encode('utf8')) %}
                        {% if h.is_list(parsed_value)  %}
                            {% for val in parsed_value %}
                                {{ h.render_link(val) | safe }}<br/>
                            {% endfor %}
                        {% else: %}
                            {{ parsed_value }}
                        {% endif %}
                    {% else: %}
                        {{ h.render_link(value) | safe }}
                    {% endif %}
                </td>
            </tr>
    {% endfor %}

    {% if c.userobj.sysadmin %}
        <tr style="border-top: 1px solid black; padding-top: 10px"><td colspan="2" style="font-weight: bold">Unknown attributes</td></tr>
    {% for extra in sortedExtras if extra not in sortedVodapExtras %}
    {% set key, value = extra %}
    <tr rel="dc:relation" resource="_:extra{{ i }}">
        <th scope="row" class="dataset-label" property="rdfs:label">
            {{ key }}
        </th>
        <td class="dataset-details" property="rdf:value">
            {{ h.render_link(value) | safe }}
        </td>
    </tr>
    {% endfor %}
    {% endif %}
{% endblock %}